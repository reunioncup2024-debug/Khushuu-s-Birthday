<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For Khushi</title>

    <!-- Google Fonts: Playfair Display + Inter (Satoshi alternative) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,500;0,600;1,400&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Dark background as requested
                        background: '#0c0a09',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    }
                }
            }
        }
    </script>

    <!-- GSAP Core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --bg-color: #0c0a09;
            --progress-color: rgba(255, 255, 255, 0.85);
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: #ffffff;
            overflow-x: hidden;
            font-family: 'Inter', sans-serif;
            /* Smooth scrolling for anchor links if added later */
            scroll-behavior: smooth;
        }

        /* Typography Utilities */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        .font-serif {
            font-family: 'Playfair Display', serif;
        }

        /* Responsive WebGL Canvas Container */
        #webgl-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            pointer-events: none;
        }

        /* Fixed Top-Centered Progress Bar */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: rgba(255, 255, 255, 0.05);
            /* Very subtle track */
            z-index: 100;
        }

        /* The bar itself is centralized using a wrapper or margin pseudo-centering. 
           We'll center the fill visually. */
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--progress-color);
            margin: 0 auto;
            /* Centered in the container */
            border-radius: 2px;
            box-shadow: 0 0 12px rgba(255, 255, 255, 0.4);
            /* Smooth transitions for updates */
            transition: width 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* Main Empty Container for Steps */
        #steps-container {
            position: relative;
            z-index: 10;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* Extra padding top to account for progress bar */
            padding-top: 3rem;
            padding-bottom: 3rem;
        }

        /* Hide scrollbar utility for clean 2026 aesthetics */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Glassmorphism Card Utilities */
        .glass-card {
            background: rgba(20, 16, 18, 0.4);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            /* Enhanced blur for a more premium finish */
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.5), inset 0 0 0 1px rgba(255, 255, 255, 0.05);
            border-radius: 1.5rem;
            padding: 3rem 2rem;
            text-align: center;
            max-width: 32rem;
            width: 100%;
            margin: 0 auto;
            position: relative;
            /* Hide initially for GSAP to reveal */
            opacity: 0;
            transform: translate3d(0, 30px, 0);
            /* use translate3d to force hardware acceleration */
            will-change: transform, opacity;
        }

        /* Bento Grid Specific Styles */
        .bento-card {
            background: rgba(20, 16, 18, 0.3);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: left;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            will-change: transform, box-shadow;
            transform: translate3d(0, 0, 0);
        }

        .bento-card:hover {
            transform: translate3d(0, -6px, 0);
            box-shadow: 0 15px 30px -10px rgba(255, 77, 121, 0.4);
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(40, 25, 30, 0.5);
        }

        /* 3D Polaroid Styles */
        .polaroid-container {
            perspective: 1000px;
            width: 100%;
            max-width: 320px;
            margin: 0 auto;
        }

        .polaroid {
            background: #ffffff;
            padding: 12px 12px 40px 12px;
            border-radius: 4px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            /* Transform preserve 3d for child parallax if needed */
            transform-style: preserve-3d;
            /* Initial tilt */
            transform: rotateZ(-3deg) rotateX(5deg) rotateY(-5deg);
            transition: transform 0.1s ease-out;
            /* Super snappy transition for JS parallax */
            will-change: transform;
            cursor: pointer;
        }

        .polaroid img {
            width: 100%;
            height: auto;
            max-width: 100%;
            /* Ensure it does not scale beyond structural bounds */
            object-fit: cover;
            border-radius: 2px;
            /* Extra crisp rendering for High DPI / Desktop / Mobile */
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            image-rendering: auto;
            filter: contrast(1.05);
            /* Slight contrast bump for better display */
            /* Prevent image dragging to keep tilt smooth */
            pointer-events: none;
        }

        .polaroid-caption {
            color: #1a1a1a;
            font-family: 'Playfair Display', serif;
            text-align: center;
            margin-top: -24px;
            font-size: 1.125rem;
            font-weight: 500;
            pointer-events: none;
        }

        /* Final Message Reveal Style */
        .finale-message {
            opacity: 0;
            transform: translateY(20px);
            display: none;
            text-shadow: 0 0 20px rgba(255, 77, 121, 0.4);
        }

        /* Calendar Styles */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            width: 100%;
            margin-top: 1.5rem;
        }

        .calendar-day-header {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.85rem;
            font-weight: 500;
            padding-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            font-size: 1.125rem;
            color: rgba(255, 255, 255, 0.9);
            position: relative;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .calendar-day.empty {
            background: transparent;
            border: none;
        }

        /* Special highlights for April 26 */
        .calendar-day.special-day {
            background: rgba(255, 77, 121, 0.15);
            border-color: rgba(255, 77, 121, 0.4);
            color: #fff;
            font-weight: 600;
            will-change: transform, box-shadow;
            /* Handled via GSAP later */
        }

        .special-day-heart {
            position: absolute;
            font-size: 2rem;
            z-index: -1;
            opacity: 0;
            /* Handled via GSAP later */
            will-change: transform, opacity;
            pointer-events: none;
        }

        /* Sparkles */
        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            opacity: 0;
            box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.8);
            pointer-events: none;
        }

        /* Realistic Premium Cake Styles */
        .cake-container {
            position: relative;
            width: 180px;
            height: 160px;
            margin: 0 auto 1.5rem auto;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            z-index: 10;
        }

        .cake-shadow {
            position: absolute;
            bottom: -15px;
            left: 10%;
            width: 80%;
            height: 30px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 50%;
            filter: blur(8px);
            z-index: 0;
            pointer-events: none;
        }

        .layer-sponge {
            width: 100%;
            height: 35px;
            background: linear-gradient(to right, #ffb6c1, #ffc0cb, #ffb6c1);
            border-radius: 8px;
            position: relative;
            z-index: 2;
            margin-bottom: -5px;
            /* overlap to hide gaps */
            box-shadow: inset 0 -4px 8px rgba(0, 0, 0, 0.05), inset 0 4px 8px rgba(255, 255, 255, 0.5);
        }

        .layer-cream {
            width: 100%;
            height: 18px;
            background: linear-gradient(to right, #fff0f5, #ffffff, #fff0f5);
            border-radius: 6px;
            position: relative;
            z-index: 3;
            margin-bottom: -5px;
            box-shadow: inset 0 -3px 5px rgba(0, 0, 0, 0.05);
        }

        .layer-frosting {
            width: 100%;
            height: 45px;
            background: linear-gradient(to right, #ff6b9e, #ff85af, #ff6b9e);
            border-radius: 12px 12px 4px 4px;
            position: relative;
            z-index: 4;
            box-shadow: inset 0 6px 10px rgba(255, 255, 255, 0.4), inset 0 -4px 6px rgba(0, 0, 0, 0.1);
        }

        .frosting-drip {
            position: absolute;
            bottom: -8px;
            width: 20px;
            height: 20px;
            background: #ff85af;
            border-radius: 50%;
            box-shadow: inset 0 -3px 4px rgba(0, 0, 0, 0.1);
        }

        .drip-1 {
            left: 10px;
            height: 25px;
        }

        .drip-2 {
            left: 40px;
        }

        .drip-3 {
            left: 75px;
            height: 28px;
            background: #ff6b9e;
        }

        .drip-4 {
            right: 40px;
        }

        .drip-5 {
            right: 10px;
            height: 22px;
        }

        .cake-decor {
            position: absolute;
            font-size: 14px;
            z-index: 5;
            filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.1));
        }

        .decor-1 {
            top: 12px;
            left: 20px;
            transform: rotate(-15deg);
        }

        .decor-2 {
            top: 18px;
            right: 25px;
            transform: rotate(15deg);
        }

        .decor-3 {
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
        }

        .candles-group {
            position: absolute;
            top: -45px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-evenly;
            padding: 0 35px;
            z-index: 5;
        }

        .candle {
            width: 12px;
            height: 40px;
            background: repeating-linear-gradient(-45deg,
                    #ffffff,
                    #ffffff 6px,
                    #ff4d79 6px,
                    #ff4d79 12px);
            border-radius: 3px 3px 2px 2px;
            position: relative;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2), inset -2px 0 4px rgba(0, 0, 0, 0.1);
        }

        .candle::before {
            content: '';
            position: absolute;
            top: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 4px;
            background: #333;
            /* Wick */
        }

        .flame {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 15px;
            background: radial-gradient(ellipse at bottom, #ffeeaa 0%, #ff8800 60%, rgba(255, 50, 0, 0) 100%);
            border-radius: 50% 50% 20% 20%;
            box-shadow: 0 0 10px rgba(255, 150, 0, 0.6), 0 0 20px rgba(255, 100, 0, 0.4);
            animation: flicker var(--flicker-duration, 1.2s) infinite alternate;
            transform-origin: bottom center;
            will-change: transform, opacity;
        }

        .flame::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 6px;
            background: #ffffff;
            border-radius: 50%;
            opacity: 0.8;
        }

        /* Unique animation timing overrides */
        .c1 .flame {
            --flicker-duration: 0.9s;
            animation-delay: 0.1s;
        }

        .c2 .flame {
            --flicker-duration: 1.1s;
            animation-delay: 0.3s;
        }

        .c3 .flame {
            --flicker-duration: 1.0s;
            animation-delay: 0.0s;
        }

        @keyframes flicker {
            0% {
                transform: translateX(-50%) rotate(-2deg) scale(0.95);
                opacity: 0.8;
            }

            25% {
                transform: translateX(-50%) rotate(2deg) scale(1.05);
                opacity: 1;
            }

            50% {
                transform: translateX(-50%) rotate(-1deg) scale(0.9);
                opacity: 0.7;
            }

            75% {
                transform: translateX(-50%) rotate(3deg) scale(1.1);
                opacity: 1;
            }

            100% {
                transform: translateX(-50%) rotate(-2deg) scale(1.0);
                opacity: 0.9;
            }
        }

        /* Beating Heart Animation */
        .heart-beat {
            display: inline-block;
            animation: beat 1.5s infinite ease-in-out;
            filter: drop-shadow(0 0 15px rgba(255, 77, 121, 0.6));
            will-change: transform;
        }

        @keyframes beat {

            0%,
            100% {
                transform: scale(1);
            }

            15% {
                transform: scale(1.15);
            }

            30% {
                transform: scale(1);
            }

            45% {
                transform: scale(1.15);
            }
        }

        /* Premium Button Styles */
        .premium-btn {
            background: linear-gradient(135deg, #ff4d79 0%, #ff0f42 100%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 0.8rem 2.8rem;
            border-radius: 9999px;
            font-size: 1.125rem;
            font-weight: 500;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.4s ease, background 0.4s ease, border-color 0.4s ease;
            box-shadow: 0 4px 15px rgba(255, 77, 121, 0.4);
            outline: none;
            will-change: transform, box-shadow;
            transform: translate3d(0, 0, 0);
        }

        .premium-btn:hover {
            transform: scale3d(1.05, 1.05, 1.05) translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 77, 121, 0.6), inset 0 0 10px rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .premium-btn:active {
            transform: scale3d(0.95, 0.95, 0.95);
        }

        /* Aurora Background Styles */
        .aurora-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -2;
            /* Behind the WebGL canvas */
            overflow: hidden;
            background-color: var(--bg-color);
        }

        .aurora-blob {
            position: absolute;
            filter: blur(90px);
            /* Soft immersive blur */
            border-radius: 50%;
            animation: breathe 25s infinite alternate ease-in-out;
            will-change: transform, opacity;
            opacity: 0.7;
        }

        /* Deep pink */
        .aurora-1 {
            top: -10%;
            left: -10%;
            width: 60vw;
            height: 60vh;
            background: hsla(333, 70%, 55%, 0.4);
            animation-delay: 0s;
        }

        /* Purple */
        .aurora-2 {
            top: 40%;
            right: -20%;
            width: 70vw;
            height: 70vh;
            background: hsla(282, 82%, 54%, 0.3);
            animation-delay: -5s;
        }

        /* Blue */
        .aurora-3 {
            bottom: -20%;
            left: 20%;
            width: 80vw;
            height: 80vh;
            background: hsla(210, 89%, 60%, 0.3);
            animation-delay: -10s;
        }

        /* Gold */
        .aurora-4 {
            top: 10%;
            left: 40%;
            width: 50vw;
            height: 50vh;
            background: hsla(35, 90%, 60%, 0.3);
            animation-delay: -15s;
        }

        @keyframes breathe {
            0% {
                transform: translate3d(0, 0, 0) scale(1.0);
                opacity: 0.4;
            }

            33% {
                transform: translate3d(5vw, 5vh, 0) scale(1.2);
                opacity: 0.6;
            }

            66% {
                transform: translate3d(-5vw, 10vh, 0) scale(0.9);
                opacity: 0.7;
            }

            100% {
                transform: translate3d(-10vw, -5vh, 0) scale(1.1);
                opacity: 0.5;
            }
        }

        /* Cake Cutting Interactive Styles */
        body.cutting-mode {
            cursor: crosshair !important;
        }

        body.cutting-mode * {
            cursor: crosshair !important;
        }

        .sliced-left,
        .sliced-right {
            position: absolute !important;
            top: 0;
            left: 0;
            margin: 0 !important;
            pointer-events: none;
        }

        .sliced-left {
            clip-path: polygon(0 0, 50% 0, 30% 100%, 0 100%);
        }

        .sliced-right {
            clip-path: polygon(70% 0, 100% 0, 100% 100%, 50% 100%);
        }

        .sliced-center {
            position: absolute !important;
            top: 0;
            left: 0;
            margin: 0 !important;
            pointer-events: none;
            clip-path: polygon(50% 0, 70% 0, 50% 100%, 30% 100%);
            z-index: 10;
        }

        .slice-line {
            position: absolute;
            background: white;
            box-shadow: 0 0 15px 3px rgba(255, 255, 255, 0.8);
            height: 2px;
            pointer-events: none;
            z-index: 50;
            top: 50%;
            left: -25%;
            width: 150%;
            transform-origin: center;
        }

        .bhuban-note {
            display: none;
            opacity: 0;
            color: rgba(255, 255, 255, 0.85);
            font-style: italic;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            margin-top: 2rem;
        }
    </style>
</head>

<body class="antialiased selection:bg-pink-400/30 selection:text-white">

    <!-- Aurora Background -->
    <div class="aurora-bg">
        <div class="aurora-blob aurora-1"></div>
        <div class="aurora-blob aurora-2"></div>
        <div class="aurora-blob aurora-3"></div>
        <div class="aurora-blob aurora-4"></div>
    </div>

    <!-- WebGL Background Canvas -->
    <div id="webgl-container"></div>

    <!-- Top Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>

    <!-- Main Container Layout -->
    <main id="steps-container"
        class="w-full max-w-5xl mx-auto px-6 sm:px-8 flex items-center justify-center min-h-[calc(100vh-6rem)]">

        <!-- STEP 1: April Calendar Card -->
        <div id="step-1" class="glass-card flex flex-col items-center justify-center gap-4">
            <h2 class="font-serif text-3xl md:text-5xl font-medium tracking-wide text-white drop-shadow-lg">
                April 2026
            </h2>

            <div class="calendar-grid mt-4">
                <!-- Headers -->
                <div class="calendar-day-header">Sun</div>
                <div class="calendar-day-header">Mon</div>
                <div class="calendar-day-header">Tue</div>
                <div class="calendar-day-header">Wed</div>
                <div class="calendar-day-header">Thu</div>
                <div class="calendar-day-header">Fri</div>
                <div class="calendar-day-header">Sat</div>

                <!-- Empty days for April 2026 (Starts on Wednesday) -->
                <div class="calendar-day empty"></div>
                <div class="calendar-day empty"></div>
                <div class="calendar-day empty"></div>

                <!-- Days 1-25 -->
                <div class="calendar-day">1</div>
                <div class="calendar-day">2</div>
                <div class="calendar-day">3</div>
                <div class="calendar-day">4</div>
                <div class="calendar-day">5</div>
                <div class="calendar-day">6</div>
                <div class="calendar-day">7</div>
                <div class="calendar-day">8</div>
                <div class="calendar-day">9</div>
                <div class="calendar-day">10</div>
                <div class="calendar-day">11</div>
                <div class="calendar-day">12</div>
                <div class="calendar-day">13</div>
                <div class="calendar-day">14</div>
                <div class="calendar-day">15</div>
                <div class="calendar-day">16</div>
                <div class="calendar-day">17</div>
                <div class="calendar-day">18</div>
                <div class="calendar-day">19</div>
                <div class="calendar-day">20</div>
                <div class="calendar-day">21</div>
                <div class="calendar-day">22</div>
                <div class="calendar-day">23</div>
                <div class="calendar-day">24</div>
                <div class="calendar-day">25</div>

                <!-- Day 26 (Special) -->
                <div class="calendar-day special-day" id="april-26">
                    <span class="z-10 relative">26</span>
                    <div class="special-day-heart" id="special-heart">‚ù§Ô∏è</div>
                    <!-- Empty sparkles ready for GSAP -->
                    <div class="sparkle" id="s1"></div>
                    <div class="sparkle" id="s2"></div>
                    <div class="sparkle" id="s3"></div>
                </div>

                <!-- Days 27-30 -->
                <div class="calendar-day">27</div>
                <div class="calendar-day">28</div>
                <div class="calendar-day">29</div>
                <div class="calendar-day">30</div>
            </div>

            <button class="premium-btn mt-6" onclick="goToStep(1, 2)">
                Excited Khushuu?
            </button>
        </div>

        <!-- STEP 2: Introduction Card (Was 1) -->
        <div id="step-2" class="glass-card flex flex-col items-center justify-center gap-6" style="display: none;">
            <div class="text-6xl mb-2 heart-beat">‚ù§Ô∏è</div>
            <h1
                class="font-serif text-3xl md:text-5xl font-medium tracking-wide leading-tight text-white drop-shadow-lg">
                Hey Khushi, My Beautiful <span class="text-pink-400">üíñ</span>
            </h1>
            <p class="text-lg md:text-xl font-light text-white/80 leading-relaxed max-w-md mx-auto">
                On April 26, the world became brighter &mdash; because you were born.
            </p>
            <button class="premium-btn mt-6" onclick="goToStep(2, 3)">
                Let&rsquo;s Begin
            </button>
        </div>

        <!-- STEP 3: Birthday Message Card -->
        <div id="step-3" class="glass-card flex flex-col items-center justify-center gap-6" style="display: none;">
            <div class="text-6xl mb-2">üéâ</div>
            <h1
                class="font-serif text-3xl md:text-5xl font-medium tracking-wide leading-tight text-white drop-shadow-lg">
                Happy Birthday, Khushi!
            </h1>
            <p class="text-lg md:text-xl font-light text-white/80 leading-relaxed max-w-md mx-auto">
                Another year of your smile lighting up lives. I feel so lucky to call you mine.
            </p>
            <button class="premium-btn mt-6" onclick="goToStep(3, 4)">
                There&rsquo;s More...
            </button>
        </div>

        <!-- STEP 4: Bento Grid Card -->
        <div id="step-4" class="glass-card flex flex-col items-center justify-center gap-6 !max-w-4xl"
            style="display: none;">
            <h2 class="font-serif text-2xl md:text-4xl font-medium tracking-wide text-white mb-2 drop-shadow-lg">
                A Few Things I Adore About You, Khushi
            </h2>

            <!-- Modern CSS Grid for Bento Layout -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">

                <!-- Large Card 1 -->
                <div class="bento-card md:col-span-2 flex flex-col justify-center">
                    <div class="text-3xl mb-3">‚ú®</div>
                    <h3 class="font-serif text-xl font-medium text-white mb-2">Your Sweet Heart &amp; Honesty</h3>
                    <p class="text-white/70 font-light leading-relaxed">
                        "The way you stay genuine and pure in everything you do makes me admire you even more every
                        day."
                    </p>
                </div>

                <!-- Small Card 1 -->
                <div class="bento-card flex flex-col justify-center">
                    <div class="text-3xl mb-3">üòä</div>
                    <h3 class="font-serif text-xl font-medium text-white mb-2">That Smile</h3>
                    <p class="text-white/70 font-light leading-relaxed">
                        "It's my favorite view in the entire world."
                    </p>
                </div>

                <!-- Small/Medium Card 2 -->
                <div class="bento-card flex flex-col justify-center">
                    <div class="text-3xl mb-3">üå∏</div>
                    <h3 class="font-serif text-xl font-medium text-white mb-2">Your Presence</h3>
                    <p class="text-white/70 font-light leading-relaxed">
                        "Just being around you makes everything feel lighter and happier."
                    </p>
                </div>

            </div>

            <button class="premium-btn mt-4" onclick="goToStep(4, 5)">
                Remember This?
            </button>
        </div>

        <!-- STEP 5: Polaroid Memory Card -->
        <div id="step-5" class="glass-card flex flex-col items-center justify-center gap-8" style="display: none;">
            <h2 class="font-serif text-3xl md:text-5xl font-medium tracking-wide text-white drop-shadow-lg">
                Last year
            </h2>

            <!-- 3D Polaroid Interactive Container -->
            <div class="polaroid-container" id="polaroid-wrapper">
                <div class="polaroid" id="polaroid-card">
                    <img src="https://files.catbox.moe/shdrth.png" alt="Our Memory">
                    <div class="polaroid-caption pt-10">Tumhare saath bitaya har lamha itni tezi se guzra ki waqt ka
                        pata hi nahi chala</div>
                </div>
            </div>

            <p class="text-lg md:text-xl font-light text-white/90 leading-relaxed max-w-sm mx-auto text-center mt-2">
                Every moment with you feels like a movie I never want to end.
            </p>

            <button class="premium-btn mt-2" onclick="goToStep(5, 6)">
                One Last Thing...
            </button>
        </div>

        <!-- STEP 6: The Grand Finale -->
        <div id="step-6" class="glass-card flex flex-col items-center justify-center gap-6" style="display: none;">

            <!-- Realistic 2D Premium Birthday Cake -->
            <div class="cake-container" id="interactive-cake">
                <div class="cake-shadow"></div>
                <div class="candles-group">
                    <div class="candle c1">
                        <div class="flame"></div>
                    </div>
                    <div class="candle c2">
                        <div class="flame"></div>
                    </div>
                    <div class="candle c3">
                        <div class="flame"></div>
                    </div>
                </div>
                <!-- Top Frosting Layer -->
                <div class="layer-frosting">
                    <div class="frosting-drip drip-1"></div>
                    <div class="frosting-drip drip-2"></div>
                    <div class="frosting-drip drip-3"></div>
                    <div class="frosting-drip drip-4"></div>
                    <div class="frosting-drip drip-5"></div>
                    <div class="cake-decor decor-1">‚ú®</div>
                    <div class="cake-decor decor-2">‚ù§Ô∏è</div>
                    <div class="cake-decor decor-3">üíñ</div>
                </div>
                <!-- Middle Sponge Layer -->
                <div class="layer-sponge"></div>
                <!-- Cream Layer -->
                <div class="layer-cream"></div>
                <!-- Bottom Sponge Layer -->
                <div class="layer-sponge"></div>
            </div>

            <h1
                class="font-serif text-3xl md:text-5xl font-medium tracking-wide leading-tight text-white drop-shadow-lg">
                My Wish For You, Khushi
            </h1>
            <p class="text-lg md:text-xl font-light text-white/90 leading-relaxed max-w-md mx-auto">
                May this year bring you everything your heart dreams of. May love follow you everywhere.
            </p>

            <button id="celebrate-btn" class="premium-btn mt-6" onclick="enableCakeCut()">
                Cut The Cake
            </button>

            <!-- Hidden Final Message Revealed on Click -->
            <div id="final-message"
                class="finale-message mt-8 font-serif text-2xl md:text-4xl font-medium text-pink-300">
                Happy Birthday, My Love Khushi ‚ù§Ô∏è
            </div>

            <div id="bhuban-msg" class="bhuban-note font-serif text-xl md:text-2xl font-light">
                "This Cake piece is for me (Bhuban)...i know Khushuu üòåüç∞"
            </div>
        </div>

    </main>

    <script>
        // Preload the specific audio recording for the cake action
        const cakeAudio = new Audio('https://files.catbox.moe/4a9r0z.ogg');
        cakeAudio.preload = 'auto';

        /**
         * 1. PROGRESS BAR CONTROLLER
         */
        const progressBar = document.getElementById('progress-bar');

        // Expose a global or wrapped function to update progress (0 to 100)
        const updateProgress = (percentage) => {
            const clampled = Math.max(0, Math.min(100, percentage));
            progressBar.style.width = `${clampled}%`;

            // Add a subtle glow when reaching 100%
            if (clampled === 100) {
                progressBar.style.boxShadow = "0 0 20px rgba(255, 255, 255, 0.8)";
            }
        };

        // There are now 6 steps total. 
        // We calculate (step - 1) / 5 * 100 for proper scaling 
        // Step 1: 0% / 15% (Initial)
        // Step 2: 20%
        // Step 3: 40%
        // Step 4: 60%
        // Step 5: 80%
        // Step 6: 100%
        updateProgress(15);

        /**
         * STEP MANAGEMENT
         */
        const goToStep = (currentStepNum, nextStepNum) => {
            const currentStep = document.getElementById(`step-${currentStepNum}`);
            const nextStep = document.getElementById(`step-${nextStepNum}`);

            if (!currentStep || !nextStep) return;

            // Transition Timeline
            const tl = gsap.timeline();

            // 1. Current step fades and scales down
            tl.to(currentStep, {
                duration: 0.6,
                scale: 0.9,
                opacity: 0,
                ease: "power2.inOut",
                onComplete: () => {
                    currentStep.style.display = "none";
                }
            })
                // 2. Prepare next step and show
                .call(() => {
                    nextStep.style.display = "flex";
                    // Start slightly scaled down so it scales *up* into place
                    gsap.set(nextStep, { scale: 0.9, opacity: 0 });
                    // We also want the children to reset so they can stagger in
                    gsap.set(nextStep.children, { y: 20, opacity: 0 });
                })
                // 3. Next step container scales up and fades in
                .to(nextStep, {
                    duration: 0.8,
                    scale: 1,
                    opacity: 1,
                    ease: "back.out(1.2)" // Slight bounce for premium feel
                })
                // 4. Stagger animate the text and button
                .to(nextStep.children, {
                    duration: 0.8,
                    y: 0,
                    opacity: 1,
                    stagger: 0.15,
                    ease: "power3.out"
                }, "-=0.4"); // overlap with container animation

            // Update Progress Bar Accurately logic to divide by 5 transitions
            updateProgress(((nextStepNum - 1) / 5) * 100);
        };

        /**
         * 2. THREE.JS SCENE SETUP
         */
        let scene, camera, renderer, particlesMesh;
        let hearts = []; // Array to hold our 3D hearts

        // Function to create a 3D Heart Shape
        const createHeartGeometry = () => {
            const x = 0, y = 0;
            const heartShape = new THREE.Shape();

            heartShape.moveTo(x + 5, y + 5);
            heartShape.bezierCurveTo(x + 5, y + 5, x + 4, y, x, y);
            heartShape.bezierCurveTo(x - 6, y, x - 6, y + 7, x - 6, y + 7);
            heartShape.bezierCurveTo(x - 6, y + 11, x - 3, y + 15.4, x + 5, y + 19);
            heartShape.bezierCurveTo(x + 12, y + 15.4, x + 16, y + 11, x + 16, y + 7);
            heartShape.bezierCurveTo(x + 16, y + 7, x + 16, y, x + 10, y);
            heartShape.bezierCurveTo(x + 7, y, x + 5, y + 5, x + 5, y + 5);

            const extrudeSettings = { depth: 2, bevelEnabled: true, bevelSegments: 3, steps: 2, bevelSize: 1, bevelThickness: 1 };
            const geometry = new THREE.ExtrudeGeometry(heartShape, extrudeSettings);

            // Center the geometry
            geometry.computeBoundingBox();
            const centerOffset = - 0.5 * (geometry.boundingBox.max.x - geometry.boundingBox.min.x);
            const centerOffsetY = - 0.5 * (geometry.boundingBox.max.y - geometry.boundingBox.min.y);
            geometry.translate(centerOffset, centerOffsetY, 0);

            // Scale down to a reasonable size for the background
            geometry.scale(0.1, 0.1, 0.1);
            // The drawing is upside down natively in ThreeJS shape depending on orientation, so flip it
            geometry.rotateZ(Math.PI);

            return geometry;
        };

        const initThreeJS = () => {
            const container = document.getElementById('webgl-container');

            // Core components
            scene = new THREE.Scene();

            // Add subtle atmospheric fog
            scene.fog = new THREE.FogExp2(0x0c0a09, 0.0015);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 25;

            renderer = new THREE.WebGLRenderer({
                alpha: true,
                antialias: true,
                powerPreference: "high-performance"
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            container.appendChild(renderer.domElement);

            // Lighting for the 3D hearts
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambientLight);

            const directionalLight1 = new THREE.DirectionalLight(0xffb6c1, 0.8);
            directionalLight1.position.set(10, 20, 10);
            scene.add(directionalLight1);

            const directionalLight2 = new THREE.DirectionalLight(0xd4af37, 0.5); // Warm gold tint
            directionalLight2.position.set(-10, -10, 10);
            scene.add(directionalLight2);

            // Placeholder Particle System
            const particlesGeometry = new THREE.BufferGeometry();
            const particlesCount = 600; // Adjusted down slightly for mobile 60fps
            const posArray = new Float32Array(particlesCount * 3);

            for (let i = 0; i < particlesCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 80;
            }

            particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));

            // Soft glowing material
            const material = new THREE.PointsMaterial({
                size: 0.05,
                color: 0xfff0f5,
                transparent: true,
                opacity: 0.6,
                blending: THREE.AdditiveBlending,
                depthWrite: false
            });

            particlesMesh = new THREE.Points(particlesGeometry, material);
            scene.add(particlesMesh);

            // 2. Add Floating Hearts
            const heartGeometry = createHeartGeometry();

            // Premium material for 3D objects
            const heartMaterial = new THREE.MeshPhysicalMaterial({
                color: 0xff4d79,
                roughness: 0.2,
                metalness: 0.3,
                clearcoat: 0.8, // Add clearcoat for premium glass-like reflection
                clearcoatRoughness: 0.2,
                transparent: true,
                opacity: 0.85
            });

            const numHearts = 25;
            for (let i = 0; i < numHearts; i++) {
                const heart = new THREE.Mesh(heartGeometry, heartMaterial);

                // Caching base positions to instance userData for faster reads
                // Math.random caching
                const randomX = (Math.random() - 0.5) * 50;
                const randomY = (Math.random() - 0.5) * 50;
                const randomZ = (Math.random() - 0.5) * 30 - 10;
                const scale = Math.random() * 0.8 + 0.4;

                heart.position.set(randomX, randomY, randomZ);
                heart.rotation.set(
                    Math.random() * Math.PI,
                    Math.random() * Math.PI,
                    Math.random() * Math.PI
                );
                heart.scale.set(scale, scale, scale);

                // Optimized caching to prevent GC pauses
                heart.userData = {
                    baseY: randomY,
                    speed: Math.random() * 0.01 + 0.005,
                    rotSpeedX: (Math.random() - 0.5) * 0.008,
                    rotSpeedY: (Math.random() - 0.5) * 0.008,
                    rotSpeedZ: (Math.random() - 0.5) * 0.008,
                    phase: Math.random() * Math.PI * 2
                };

                heart.matrixAutoUpdate = true; // explicitly true to allow individual heart animations
                scene.add(heart);
                hearts.push(heart);
            }

            // Mouse interaction logic could go here later

            // Animation Loop
            const clock = new THREE.Clock();

            const tick = () => {
                const elapsedTime = clock.getElapsedTime();

                // Gentle ambient rotation
                if (particlesMesh) {
                    particlesMesh.rotation.y = elapsedTime * 0.03;
                    particlesMesh.rotation.x = elapsedTime * 0.015;
                }

                // Animate Hearts
                hearts.forEach(heart => {
                    // Sine-wave floating motion
                    heart.position.y = heart.userData.baseY + Math.sin(elapsedTime * heart.userData.speed * 100 + heart.userData.phase) * 2;

                    // Slow rotation
                    heart.rotation.x += heart.userData.rotSpeedX;
                    heart.rotation.y += heart.userData.rotSpeedY;
                    heart.rotation.z += heart.userData.rotSpeedZ;
                });

                renderer.render(scene, camera);
                window.requestAnimationFrame(tick);
            };

            tick();

            // Resize Event Listener
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            });
        };

        // Initialize 3D Background smoothly
        try {
            initThreeJS();
            // Fade in canvas smoothly
            gsap.from("#webgl-container", {
                opacity: 0,
                duration: 2,
                ease: "power2.inOut"
            });
        } catch (e) {
            console.warn("WebGL/Three.js not supported or failed:", e);
        }

        /**
         * 3. CONFETTI UTILITY (Cinematic Finale)
         */
        const triggerPremiumConfetti = () => {
            const duration = 5000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            // Custom emoji shapes
            const scalar = 2;
            const heartEmoji = confetti.shapeFromText({ text: '‚ù§Ô∏è', scalar });
            const sparkleEmoji = confetti.shapeFromText({ text: '‚ú®', scalar });
            const pinkHeartEmoji = confetti.shapeFromText({ text: 'üíñ', scalar });

            const randomInRange = (min, max) => Math.random() * (max - min) + min;

            const interval = setInterval(function () {
                const timeLeft = animationEnd - Date.now();

                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }

                const particleCount = 20 * (timeLeft / duration);

                // Continuous rain from top wide spread
                confetti(Object.assign({}, defaults, {
                    particleCount,
                    origin: { x: randomInRange(0.1, 0.9), y: Math.random() - 0.2 },
                    shapes: [heartEmoji, sparkleEmoji, 'circle'],
                    colors: ['#ff4d79', '#ffffff', '#FFD700']
                }));
            }, 250);

            // Big Burst from Bottom Left
            confetti({
                particleCount: 150,
                spread: 80,
                startVelocity: 60,
                origin: { x: 0, y: 1 },
                shapes: [pinkHeartEmoji, 'circle', 'square'],
                colors: ['#ff4d79', '#D4AF37', '#ffffff']
            });

            // Big Burst from Bottom Right
            setTimeout(() => {
                confetti({
                    particleCount: 150,
                    spread: 80,
                    startVelocity: 60,
                    origin: { x: 1, y: 1 },
                    shapes: [heartEmoji, 'circle', 'square'],
                    colors: ['#ff4d79', '#D4AF37', '#ffffff']
                });
            }, 200);
        };

        /**
         * 4. GSAP INITIALIZATION & ANIMATIONS
         */

        gsap.config({
            nullTargetWarn: false
        });

        // Initial Entry Animation for Step 1
        window.addEventListener('load', () => {
            // Fade in card
            gsap.to("#step-1", {
                duration: 1.5,
                y: 0,
                opacity: 1,
                ease: "power3.out",
                delay: 0.5 // Start slightly after the 3D canvas fades in
            });

            // Stagger child elements inside card for elegant reveal
            gsap.fromTo("#step-1 > *",
                { y: 20, opacity: 0 },
                {
                    duration: 1.2,
                    y: 0,
                    opacity: 1,
                    ease: "power3.out",
                    stagger: 0.2,
                    delay: 0.8
                }
            );

            // Special Animation for April 26th
            setTimeout(() => {
                const day26 = document.getElementById('april-26');
                const heart = document.getElementById('special-heart');
                const s1 = document.getElementById('s1');
                const s2 = document.getElementById('s2');
                const s3 = document.getElementById('s3');

                if (day26) {
                    const tl = gsap.timeline();

                    // Scale up and glow
                    tl.to(day26, {
                        scale: 1.15,
                        boxShadow: "0 0 25px rgba(255, 77, 121, 0.6)",
                        backgroundColor: "rgba(255, 77, 121, 0.3)",
                        duration: 1,
                        ease: "elastic.out(1, 0.5)"
                    })
                        // Reveal soft background heart
                        .to(heart, {
                            opacity: 0.4,
                            scale: 1.5,
                            duration: 0.8,
                            ease: "power2.out"
                        }, "-=0.8")
                        // Subtle continuous pulse on the number wrapper
                        .to(day26, {
                            scale: 1.1,
                            boxShadow: "0 0 15px rgba(255, 77, 121, 0.4)",
                            duration: 1.5,
                            repeat: -1,
                            yoyo: true,
                            ease: "power1.inOut"
                        });

                    // Animate Sparkles organically
                    gsap.to(s1, { opacity: 1, x: -15, y: -20, rotation: 45, duration: 1, yoyo: true, repeat: -1, ease: "sine.inOut" }, "-=1");
                    gsap.to(s2, { opacity: 0.8, x: 20, y: -10, rotation: -30, duration: 1.2, delay: 0.2, yoyo: true, repeat: -1, ease: "sine.inOut" }, "-=1");
                    gsap.to(s3, { opacity: 1, x: -5, y: 25, rotation: 60, duration: 0.9, delay: 0.4, yoyo: true, repeat: -1, ease: "sine.inOut" }, "-=1");
                }
            }, 1000); // Wait 1 full second *after* DOM load sequence has fired (~2.5 seconds total perceived delay)
        });

        // 5. Polaroid Parallax Effect
        const polaroidWrapper = document.getElementById('polaroid-wrapper');
        const polaroidCard = document.getElementById('polaroid-card');

        if (polaroidWrapper && polaroidCard) {
            polaroidWrapper.addEventListener('mousemove', (e) => {
                const rect = polaroidWrapper.getBoundingClientRect();

                // Calculate mouse position relative to center of the container (-1 to 1)
                const x = (e.clientX - rect.left - rect.width / 2) / (rect.width / 2);
                const y = (e.clientY - rect.top - rect.height / 2) / (rect.height / 2);

                // Intense 3D tilt calculations
                const rotateX = -y * 15 + 5; // Base tilt is 5deg
                const rotateY = x * 15 - 5;  // Base tilt is -5deg
                const rotateZ = -3;          // Keep base rotation

                // Apply live tilt styling
                polaroidCard.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) rotateZ(${rotateZ}deg) scale3d(1.05, 1.05, 1.05)`;

                // Optional glowing effect based on mouse 
                polaroidCard.style.boxShadow = `${-x * 10}px ${-y * 10 + 20}px 35px rgba(0,0,0,0.6)`;
            });

            // Reset back to initial state slowly when mouse leaves
            polaroidWrapper.addEventListener('mouseleave', () => {
                polaroidCard.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.5s ease';
                polaroidCard.style.transform = 'rotateZ(-3deg) rotateX(5deg) rotateY(-5deg)';
                polaroidCard.style.boxShadow = '0 15px 35px rgba(0, 0, 0, 0.5)';

                // Remove transition back to snappiness after animation completes
                setTimeout(() => {
                    polaroidCard.style.transition = 'transform 0.1s ease-out';
                }, 500);
            });

            // Re-apply smooth snappy transition when entering
            polaroidWrapper.addEventListener('mouseenter', () => {
                polaroidCard.style.transition = 'transform 0.1s ease-out, box-shadow 0.1s ease-out';
            });
        }

        // Finale Logic
        const celebrateFinale = () => {
            const btn = document.getElementById('celebrate-btn');
            const finalMsg = document.getElementById('final-message');

            // Disable button click immediately
            btn.onclick = null;
            btn.style.pointerEvents = 'none';

            // 1. Fade out the button
            gsap.to(btn, {
                duration: 0.5,
                opacity: 0,
                y: -10,
                ease: "power2.in",
                onComplete: () => btn.style.display = 'none'
            });

            // 2. Fade in the final text
            finalMsg.style.display = 'block';
            gsap.to(finalMsg, {
                duration: 1.5,
                opacity: 1,
                y: 0,
                ease: "power3.out",
                delay: 0.3
            });

            // 3. Trigger cinematic confetti
            triggerPremiumConfetti();

            // 4. Animate 3D Hearts Swirl Effect (Cinematic & Smooth)
            if (hearts && hearts.length > 0) {
                hearts.forEach((heart, index) => {
                    // Interrupt the internal tick animation bobbing logic
                    heart.userData.speed = 0;

                    // Calculate a spiral trajectory
                    const angle = (index / hearts.length) * Math.PI * 2;

                    // Destination coordinates: wider spread, higher up
                    const radius = 80 + Math.random() * 40;
                    const targetX = Math.cos(angle) * radius;
                    const targetY = 80 + Math.random() * 40;
                    const targetZ = heart.position.z - (20 + Math.random() * 20); // Push back

                    // Use a timeline for perfect synchronization and cinematic easing
                    const tl = gsap.timeline();

                    // 1. Gently start floating up and outward in a swirl pattern
                    tl.to(heart.position, {
                        x: targetX,
                        y: targetY,
                        z: targetZ,
                        duration: 7 + Math.random() * 3, // 7-10 seconds total duration
                        ease: "power2.out" // Smooth deceleration, very cinematic
                    }, 0) // Start at time 0

                        // 2. Add continuous majestic rotation
                        .to(heart.rotation, {
                            x: `+=${Math.PI * 2}`,
                            y: `+=${Math.PI * 3}`,
                            z: `+=${Math.PI}`,
                            duration: 7 + Math.random() * 3,
                            ease: "power1.inOut" // Soft ramping of spin speed
                        }, 0)

                        // 3. Keep opacity solid for the first 3 seconds to enjoy the swirl, then fade
                        .to(heart.material, {
                            opacity: 0,
                            duration: 4,
                            ease: "power1.inOut"
                        }, 3); // Start fade at exactly 3 seconds into the animation
                });
            }
        };

        // ------------------
        // Cake Cutting Logic
        // ------------------
        let isCuttingMode = false;
        let swipeStartX = 0;
        let swipeStartY = 0;
        let isSwiping = false;

        const enableCakeCut = () => {
            const btn = document.getElementById('celebrate-btn');
            btn.innerText = "Slice the cake!";

            // disable button so it doesn't get clicked again while cutting
            btn.style.pointerEvents = 'none';
            btn.style.opacity = '0.7';

            isCuttingMode = true;
            document.body.classList.add('cutting-mode');

            // Play voice recording precisely on the user interaction (click) to avoid mobile autoplay blocks
            cakeAudio.currentTime = 0;
            const playPromise = cakeAudio.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log("Audio playback was blocked by browser.");
                });
            }
        };

        const triggerSliceAnimation = (angle) => {
            const cakeOriginal = document.getElementById('interactive-cake');
            if (!cakeOriginal) return;

            const parent = cakeOriginal.parentElement;

            // Create wrapper matching original cake size/position
            const wrapper = document.createElement('div');
            wrapper.style.position = 'relative';
            wrapper.style.width = cakeOriginal.offsetWidth + 'px';
            wrapper.style.height = cakeOriginal.offsetHeight + 'px';
            wrapper.style.margin = '0 auto 1.5rem auto';
            wrapper.style.zIndex = '10';

            // Create clones
            const leftHalf = cakeOriginal.cloneNode(true);
            const rightHalf = cakeOriginal.cloneNode(true);
            const centerSlice = cakeOriginal.cloneNode(true); // New middle slice

            leftHalf.id = ''; rightHalf.id = ''; centerSlice.id = '';

            leftHalf.className = "cake-container sliced-left";
            rightHalf.className = "cake-container sliced-right";
            centerSlice.className = "cake-container sliced-center";

            wrapper.appendChild(leftHalf);
            wrapper.appendChild(rightHalf);
            wrapper.appendChild(centerSlice);

            // Add slice line to wrapper
            const sliceLine = document.createElement('div');
            sliceLine.className = 'slice-line';
            sliceLine.style.transform = `rotate(${angle}rad) translateY(-50%)`;
            wrapper.appendChild(sliceLine);

            parent.insertBefore(wrapper, cakeOriginal);
            cakeOriginal.style.display = 'none';

            // Animate slice line flash
            gsap.fromTo(sliceLine, { opacity: 1, scaleX: 0 }, { opacity: 0, scaleX: 1, duration: 0.4, ease: "power2.out" });

            // Animate the main split visually (bouncing out slightly)
            gsap.to(leftHalf, { x: -35, y: 10, rotation: -8, duration: 1.2, ease: "bounce.out" });
            gsap.to(rightHalf, { x: 35, y: 5, rotation: 8, duration: 1.2, ease: "bounce.out" });

            // Animate the center slice popping OUT and UP with high elasticity
            gsap.to(centerSlice, {
                y: -75,
                x: 0,
                scale: 1.15,
                rotation: -5,
                duration: 2.0,
                ease: "elastic.out(1, 0.4)",
                delay: 0.1,
                onComplete: () => {
                    // Trigger tiny confetti burst specifically for this slice
                    confetti({
                        particleCount: 40,
                        spread: 40,
                        origin: { y: 0.6 },
                        colors: ['#ffffff', '#ff4d79'],
                        disableForReducedMotion: true
                    });

                    // Reveal the Bhuban message
                    const bhubanMsg = document.getElementById('bhuban-msg');
                    if (bhubanMsg) {
                        bhubanMsg.style.display = 'block';
                        gsap.fromTo(bhubanMsg, { opacity: 0, y: 15 }, { opacity: 1, y: 0, duration: 1, ease: "power2.out" });
                    }
                }
            });

            // Trigger finale instantly so things happen at same time as cut
            celebrateFinale();
        };

        const handleSwipeStart = (e) => {
            if (!isCuttingMode) return;
            isSwiping = true;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            swipeStartX = clientX;
            swipeStartY = clientY;
        };

        const handleSwipeEnd = (e) => {
            if (!isCuttingMode || !isSwiping) return;
            isSwiping = false;

            const clientX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
            const clientY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;

            const deltaX = clientX - swipeStartX;
            const deltaY = clientY - swipeStartY;
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);

            if (distance > 50) { // accurate enough swipe threshold
                isCuttingMode = false;
                document.body.classList.remove('cutting-mode');

                // Calculate angle for the slice line
                const angle = Math.atan2(deltaY, deltaX);

                triggerSliceAnimation(angle);
            }
        };

        window.addEventListener('mousedown', handleSwipeStart);
        window.addEventListener('touchstart', handleSwipeStart, { passive: true });
        window.addEventListener('mouseup', handleSwipeEnd);
        window.addEventListener('touchend', handleSwipeEnd);

    </script>
</body>

</html>